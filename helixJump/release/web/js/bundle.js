var polea=(()=>{var e=class extends Laya.Script3D{constructor(){super()}onAwake(){Laya.stage.on("MoveCamera",this,this.follow),Laya.stage.on("Continue",this,this.reset)}onEnable(){}onDisable(){}follow(e){Laya.Tween.to(this.owner.transform,{localPositionY:e},300)}reset(){console.log("reset"),this.owner.transform.localPositionY=1.3}},t=class extends Laya.Script3D{constructor(){super(),this._throughCount=0}onAwake(){this.characterCtrl=this.owner.addComponent(Laya.CharacterController);let e=new Laya.SphereColliderShape(.5);this.characterCtrl.colliderShape=e,this.characterCtrl.jumpSpeed=8,this.characterCtrl.fallSpeed=10,this._physicsSimulation=this.owner.parent.physicsSimulation,this._ray=new Laya.Ray(new Laya.Vector3,new Laya.Vector3(0,-1,0)),this._hitResult=new Laya.HitResult,Laya.timer.frameLoop(1,this,this.rayCast),Laya.stage.on("Continue",this,this.reset)}onEnable(){}onDisable(){}reset(){this.owner.transform.localScaleY=.3,this.owner.transform.localPositionY=0}rayCast(){if(this._ray.origin=this.owner.transform.position,this._throughCount>=3&&this._physicsSimulation.rayCast(this._ray,this._hitResult,.2)){let e=this._hitResult.collider,t=e.owner.parent.numChildren;for(let a=0;a<t;a++){let t=e.owner.parent.getChildAt(a);t.name="Bar",t.meshRenderer.material.albedoColor.x=0,t.meshRenderer.material.albedoColor.y=0,t.meshRenderer.material.albedoColor.z=1}}if(this._physicsSimulation.rayCast(this._ray,this._hitResult,.2)){let e=this._hitResult.collider;if("Obstacle"==e.owner.name)return this.owner.transform.localScaleY=.15,void Laya.stage.event("GameOver");e.isTrigger?(this._throughCount++,Laya.SoundManager.playSound("res/sounds/DestSound.mp3"),e.owner.parent.removeSelf(),Laya.Pool.recover("Platform",e.owner.parent),Laya.stage.event("MoveCamera",e.owner.parent.transform.localPositionY),Laya.stage.event("SpawnPlatform"),this._throughCount>=3?(Laya.stage.event("Hint",3),Laya.stage.event("AddScore",3)):(Laya.stage.event("Hint",1),Laya.stage.event("AddScore",1))):(this._throughCount=0,Laya.SoundManager.playSound("res/sounds/jumpSound.mp3"),this.characterCtrl.jump(),Laya.stage.event("SpawnParticle",this._hitResult.point))}}},a=class extends Laya.Script{constructor(){super(),this._gameOver=!1,this._lastMouseX=0,this._firstTouch=!0}onAwake(){Laya.stage.on("GameOver",this,()=>{this._gameOver=!0}),Laya.Browser.onPC&&(Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDown),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.onMouseUp),Laya.stage.on(Laya.Event.MOUSE_OUT,this,this.onMouseUp)),Laya.stage.on("Continue",this,this.reset)}reset(){this._gameOver=!1,this.owner.transform.localRotationEulerY=0}onMouseDown(e){this._lastMouseX=Laya.stage.mouseX,Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.onMouseMove)}onMouseMove(e){if(this._gameOver)return;let t=Laya.stage.mouseX-this._lastMouseX;this._lastMouseX=Laya.stage.mouseX,this.owner.transform.rotate(new Laya.Vector3(0,t/5,0),!0,!1)}onMouseUp(){Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.onMouseMove)}onEnable(){}onDisable(){}onUpdate(){if(!Laya.Browser.onPC&&!this._gameOver)if(1==this.owner.parent.input.touchCount()){let e=this.owner.parent.input.getTouch(0);if(this._firstTouch)this._firstTouch=!1,this._lastMouseX=e.position.x;else{let t=e.position.x-this._lastMouseX;this._lastMouseX=Laya.stage.mouseX,this.owner.transform.rotate(new Laya.Vector3(0,t/5,0),!0,!1)}}else this._firstTouch=!0,this._lastMouseX=0}},s=class extends Laya.Script{constructor(){super()}init(e,t){this._prefab=e,this._parent=t,Laya.stage.on("SpawnParticle",this,this.spawn)}spawn(e){let t=Laya.Pool.getItemByCreateFun("Particle",this.create,this);this._parent.addChild(t),t.transform.localPosition=e,Laya.timer.once(1500,this,()=>{t.removeSelf(),Laya.Pool.recover("Particle",t)})}create(){return Laya.Sprite3D.instantiate(this._prefab,this._parent)}},o=class extends Laya.Script{constructor(){super(),this._curIdx=0,this._curPosY=-1,this._spanHeight=1.5,this._platformArr=[]}onEnable(){}onDisable(){}init(e,t){this._prefab=e,this._parent=t,this.createPlatform(),Laya.stage.on("SpawnPlatform",this,this.spawn),Laya.stage.on("Continue",this,this.reset)}reset(){this._platformArr.forEach(e=>{e.displayedInStage&&(e.removeSelf(),Laya.Pool.recover("Platform",e))}),this._curIdx=0,this.createPlatform(),this._platformArr=[]}createPlatform(){for(let e=0;e<5;e++)this.spawn()}spawn(){let e=Laya.Pool.getItemByCreateFun("Platform",this.create,this),t=this._curPosY-this._curIdx*this._spanHeight;e.transform.localPosition=new Laya.Vector3(0,t,0),this._parent.addChild(e),this.emptyPlatform(e),this._platformArr.push(e),this._curIdx++}create(){return Laya.Sprite3D.instantiate(this._prefab,this._parent)}emptyPlatform(e){let t=0,a=this.getRandom(0,e.numChildren-1);if(0!=this._curIdx){for(let s=0;s<e.numChildren;s++){let o=e.getChildAt(s);o.meshRenderer.enable=!0,o.getComponent(Laya.PhysicsCollider).isTrigger=!1,o.meshRenderer.material.albedoColor.x=0,o.meshRenderer.material.albedoColor.y=0,o.meshRenderer.material.albedoColor.z=0,o.name="Bar";let r=this.getRandom(0,10);a!=s&&t<=4&&r>8?(t++,o.meshRenderer.enable=!1,o.getComponent(Laya.PhysicsCollider).isTrigger=!0):a==s&&(o.name="Obstacle",o.meshRenderer.material.albedoColor.x=1,o.meshRenderer.material.albedoColor.y=0,o.meshRenderer.material.albedoColor.z=0)}if(0==t){let t=e.getChildAt(0);t.name="Bar",t.meshRenderer.enable=!1,t.getComponent(Laya.PhysicsCollider).isTrigger=!0}}else this.resetPlatform(e)}resetPlatform(e){for(let t=0;t<e.numChildren;t++){let a=e.getChildAt(t);a.meshRenderer.material.albedoColor.x=0,a.meshRenderer.material.albedoColor.y=0,a.meshRenderer.material.albedoColor.z=0,a.name="Bar",0==t||1==t?(a.meshRenderer.enable=!1,a.getComponent(Laya.PhysicsCollider).isTrigger=!0):(a.meshRenderer.enable=!0,a.getComponent(Laya.PhysicsCollider).isTrigger=!1)}}getRandom(e,t){let a=t-e,s=Math.random()*a;return e+Math.round(s)}},r=class extends Laya.Script{constructor(){super()}onAwake(){Laya.Scene3D.load("res/3dScene/LayaScene_Main/Conventional/Main.ls",Laya.Handler.create(this,this.onLoaded))}onLoaded(r){console.time("start"),Laya.stage.addChild(r),r.zOrder=-1;let n=r.getChildByName("Parent");n.addComponent(a),console.timeEnd("start"),Laya.stage.on("Continue",this,this.reset),Laya.timer.callLater(this,()=>{let a=n.getChildByName("Platform"),i=Laya.Sprite3D.instantiate(a);a.active=!1,this.owner.addComponent(o).init(i,n),r.getChildByName("Main Camera").addComponent(e),this._column=n.getChildByName("Column"),Laya.stage.on("SpawnPlatform",this,this.moveColumn);let l=r.getChildByName("Player");l.addComponent(t);let h=r.getChildByName("TrailRender");l.addChild(h),h.transform.localPosition=new Laya.Vector3;let c=r.getChildByName("Particle"),y=Laya.Sprite3D.instantiate(c);c.active=!1,this.owner.addComponent(s).init(y,r)})}moveColumn(){this._column.transform.localPositionY-=1.5}reset(){this._column.transform.localPositionY=0}onEnable(){}onDisable(){}},n=class extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}onAwake(){Laya.stage.on("Hint",this,this.show)}show(e){let t=Laya.Pool.getItemByCreateFun("Hint",this.create,this);t.text=`+${e}`,Laya.stage.addChild(t),t.pos(250,650),Laya.Tween.to(t,{y:620},500,Laya.Ease.backIn,Laya.Handler.create(this,()=>{t.removeSelf(),Laya.Pool.recover("Hint",t)}))}create(){return this.txt_Hint.create()}},i=class extends Laya.Script{constructor(){super(),this._score=0}onAwake(){Laya.stage.on("AddScore",this,this.addScore),Laya.stage.on("GameOver",this,this.gameOver)}addScore(e){this._score+=e,this.txt_score.text=`${this._score}`}gameOver(){this.panel_result.visible=!0,this.txt_score.visible=!1,this.panel_result.getChildByName("txt_result_score").text=`${this._score}`,this.panel_result.getChildByName("btn_continue").on(Laya.Event.CLICK,this,this.onContinue)}onContinue(){this._score=0,this.txt_score.visible=!0,this.panel_result.visible=!1,Laya.stage.event("Continue"),this.panel_result.getChildByName("btn_continue").off(Laya.Event.CLICK,this,this.onContinue)}onEnable(){}onDisable(){}},l=class{constructor(){}static init(){var e=Laya.ClassUtils.regClass;e("scripts/App.ts",r),e("scripts/ScoreHint.ts",n),e("scripts/UIManager.ts",i)}};l.width=1080,l.height=1920,l.scaleMode="fixedwidth",l.screenMode="vertical",l.alignV="top",l.alignH="left",l.startScene="Main.scene",l.sceneRoot="",l.debug=!1,l.stat=!0,l.physicsDebug=!1,l.exportSceneToJson=!0,l.init();new class{constructor(){window.Laya3D?Laya3D.init(l.width,l.height):Laya.init(l.width,l.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=l.scaleMode,Laya.stage.screenMode=l.screenMode,Laya.stage.alignV=l.alignV,Laya.stage.alignH=l.alignH,Laya.URL.exportSceneToJson=l.exportSceneToJson,(l.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),l.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),l.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){l.startScene&&Laya.Scene.open(l.startScene)}}})();